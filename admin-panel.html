<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UC Coin Ultra - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-900 to-purple-900">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üîê</span>
                </div>
                <h1 class="text-2xl font-bold text-white">Admin Panel</h1>
                <p class="text-gray-400">UC Coin Ultra Management</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                    <input type="email" id="adminEmail" required 
                           class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400"
                           placeholder="admin@example.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="adminPassword" required 
                           class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400"
                           placeholder="Enter password">
                </div>
                
                <button type="submit" 
                        class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105">
                    Login
                </button>
            </form>
            
            <div id="loginError" class="mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm hidden"></div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-xl">‚ö°</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">UC Coin Ultra</h1>
                        <p class="text-gray-400 text-sm">Admin Dashboard</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <span id="adminInfo" class="text-gray-300"></span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-gray-800 border-b border-gray-700 px-6 py-2">
            <div class="flex space-x-1">
                <button onclick="showSection('dashboard')" class="nav-btn px-4 py-2 rounded-lg transition-colors hover:bg-gray-700" data-section="dashboard">
                    üìä Dashboard
                </button>
                <button onclick="showSection('users')" class="nav-btn px-4 py-2 rounded-lg transition-colors hover:bg-gray-700" data-section="users">
                    üë• Users
                </button>
                <button onclick="showSection('missions')" class="nav-btn px-4 py-2 rounded-lg transition-colors hover:bg-gray-700" data-section="missions">
                    üéØ Missions
                </button>
                <button onclick="showSection('categories')" class="nav-btn px-4 py-2 rounded-lg transition-colors hover:bg-gray-700" data-section="categories">
                    üí∞ Categories
                </button>
                <button onclick="showSection('conversions')" class="nav-btn px-4 py-2 rounded-lg transition-colors hover:bg-gray-700" data-section="conversions">
                    üîÑ Conversions
                </button>
                <button onclick="showSection('promo-codes')" class="nav-btn px-4 py-2 rounded-lg transition-colors hover:bg-gray-700" data-section="promo-codes">
                    üé´ Promo Codes
                </button>
            </div>
        </nav>

        <!-- Content -->
        <main class="p-6">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Total Users</p>
                                <p id="totalUsers" class="text-2xl font-bold text-blue-400">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üë•</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Active Today</p>
                                <p id="activeToday" class="text-2xl font-bold text-green-400">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üü¢</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Total Earned</p>
                                <p id="totalEarned" class="text-2xl font-bold text-yellow-400">0</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üí∞</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Pending Conversions</p>
                                <p id="pendingConversions" class="text-2xl font-bold text-orange-400">0</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-500/20 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">‚è≥</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="usersSection" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">User Management</h2>
                    <div class="flex space-x-4">
                        <input type="text" id="userSearch" placeholder="Search users..." 
                               class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400">
                        <button onclick="searchUsers()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg transition-colors">
                            Search
                        </button>
                    </div>
                </div>
                
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                    <div id="usersTable" class="overflow-x-auto">
                        <!-- Users table will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categoriesSection" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Wallet Categories</h2>
                    <button onclick="showCreateCategoryModal()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg transition-colors">
                        + Add Category
                    </button>
                </div>
                
                <div id="categoriesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <!-- Missions Section -->
            <div id="missionsSection" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Mission Management</h2>
                    <button onclick="showCreateMissionModal()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg transition-colors">
                        + Add Mission
                    </button>
                </div>
                
                <div id="missionsContainer" class="space-y-4">
                    <!-- Missions will be loaded here -->
                </div>
            </div>

            <!-- Conversions Section -->
            <div id="conversionsSection" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Conversion Management</h2>
                    <select id="conversionFilter" onchange="loadConversions()" class="bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white">
                        <option value="all">All Conversions</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                
                <div id="conversionsContainer" class="space-y-4">
                    <!-- Conversions will be loaded here -->
                </div>
            </div>

            <!-- Promo Codes Section -->
            <div id="promoCodesSection" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Promo Code Management</h2>
                    <button onclick="showCreatePromoModal()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg transition-colors">
                        + Add Promo Codes
                    </button>
                </div>
                
                <div id="promoCodesContainer" class="space-y-4">
                    <!-- Promo codes will be loaded here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modals will be added here -->
    <div id="modalContainer"></div>

    <script>
        let currentAdmin = null;
        const API_BASE = 'backend/panelApi.php';

        // API Request function
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE}?path=${encodeURIComponent(endpoint)}`;
            
            const headers = {
                'Content-Type': 'application/json',
                'X-Admin-Email': currentAdmin?.email || '',
                'X-Admin-Password': currentAdmin?.password || '',
                ...options.headers
            };

            try {
                const response = await fetch(url, {
                    ...options,
                    headers
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                return await response.json();
            } catch (error) {
                console.error(`API Request failed for ${endpoint}:`, error);
                throw error;
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            try {
                const response = await fetch(`${API_BASE}?path=login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentAdmin = { email, password };
                    document.getElementById('adminInfo').textContent = email;
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    showSection('dashboard');
                } else {
                    errorDiv.textContent = result.error || 'Login failed';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                errorDiv.textContent = 'Connection error: ' + error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        // Logout
        function logout() {
            currentAdmin = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('text-gray-300');
            });
            
            // Show selected section
            const section = document.getElementById(sectionName + 'Section');
            if (section) {
                section.classList.remove('hidden');
                section.classList.add('fade-in');
            }
            
            // Highlight active nav button
            const navBtn = document.querySelector(`[data-section="${sectionName}"]`);
            if (navBtn) {
                navBtn.classList.add('bg-blue-600', 'text-white');
                navBtn.classList.remove('text-gray-300');
            }
            
            // Load section data
            switch (sectionName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'missions':
                    loadMissions();
                    break;
                case 'categories':
                    loadCategories();
                    break;
                case 'conversions':
                    loadConversions();
                    break;
                case 'promo-codes':
                    loadPromoCodes();
                    break;
            }
        }

        // Load dashboard stats
        async function loadDashboard() {
            try {
                const stats = await apiRequest('stats');
                
                document.getElementById('totalUsers').textContent = stats.users.total;
                document.getElementById('activeToday').textContent = stats.users.activeToday;
                document.getElementById('totalEarned').textContent = stats.mining.totalEarned.toFixed(2);
                document.getElementById('pendingConversions').textContent = stats.conversions.pending;
            } catch (error) {
                console.error('Failed to load dashboard:', error);
            }
        }

        // Load users
        async function loadUsers(page = 1, search = '') {
            try {
                const data = await apiRequest(`users&page=${page}&search=${encodeURIComponent(search)}`);
                
                let html = `
                    <table class="w-full">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">User</th>
                                <th class="px-4 py-3 text-left">Balance</th>
                                <th class="px-4 py-3 text-left">Level</th>
                                <th class="px-4 py-3 text-left">Status</th>
                                <th class="px-4 py-3 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.users.forEach(user => {
                    const statusColor = user.status === 'active' ? 'text-green-400' : 
                                       user.status === 'banned' ? 'text-red-400' : 'text-yellow-400';
                    
                    html += `
                        <tr class="border-b border-gray-700 hover:bg-gray-700/50">
                            <td class="px-4 py-3">
                                <div class="flex items-center space-x-3">
                                    <img src="${user.avatar_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.first_name) + '&background=4CAF50&color=fff&size=40'}" 
                                         class="w-10 h-10 rounded-full" alt="Avatar">
                                    <div>
                                        <p class="font-semibold">${user.first_name} ${user.last_name || ''}</p>
                                        <p class="text-gray-400 text-sm">${user.id}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-4 py-3">${parseFloat(user.balance).toFixed(3)} DRX</td>
                            <td class="px-4 py-3">Level ${user.level_num}</td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusColor} bg-gray-700">
                                    ${user.status}
                                </span>
                            </td>
                            <td class="px-4 py-3">
                                <button onclick="editUser('${user.id}')" class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded text-sm transition-colors">
                                    Edit
                                </button>
                                <button onclick="banUser('${user.id}', '${user.status === 'banned' ? 'active' : 'banned'}')" 
                                        class="ml-2 ${user.status === 'banned' ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600'} px-3 py-1 rounded text-sm transition-colors">
                                    ${user.status === 'banned' ? 'Unban' : 'Ban'}
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                document.getElementById('usersTable').innerHTML = html;
            } catch (error) {
                console.error('Failed to load users:', error);
            }
        }

        // Search users
        function searchUsers() {
            const search = document.getElementById('userSearch').value;
            loadUsers(1, search);
        }

        // Edit user
        function editUser(userId) {
            // Implementation for user editing modal
            console.log('Edit user:', userId);
        }

        // Ban/Unban user
        async function banUser(userId, newStatus) {
            try {
                await apiRequest(`users&userId=${userId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: newStatus })
                });
                
                loadUsers(); // Reload users list
            } catch (error) {
                console.error('Failed to update user status:', error);
            }
        }

        // Load categories
        async function loadCategories() {
            try {
                const categories = await apiRequest('categories');
                
                let html = '';
                categories.forEach(category => {
                    html += `
                        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <img src="${category.image}" class="w-12 h-12 rounded-lg object-cover" alt="${category.name}">
                                    <div>
                                        <h3 class="font-bold text-lg">${category.name}</h3>
                                        <p class="text-gray-400 text-sm">${category.description}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editCategory('${category.id}')" class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded text-sm transition-colors">
                                        Edit
                                    </button>
                                    <button onclick="deleteCategory('${category.id}')" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm transition-colors">
                                        Delete
                                    </button>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">Min/Max:</span>
                                    <span class="text-white">${category.minConversion} - ${category.maxConversion}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">ID Length:</span>
                                    <span class="text-white">${category.minIdLength} - ${category.maxIdLength}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Rate:</span>
                                    <span class="text-white">${category.conversionRate}x</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Status:</span>
                                    <span class="${category.active ? 'text-green-400' : 'text-red-400'}">${category.active ? 'Active' : 'Inactive'}</span>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <span class="text-gray-400 text-sm">Packages: ${category.packages.length}</span>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('categoriesContainer').innerHTML = html;
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }

        // Load missions
        async function loadMissions() {
            try {
                const missions = await apiRequest('missions');
                
                let html = '';
                missions.forEach(mission => {
                    const statusColor = mission.active ? 'text-green-400' : 'text-red-400';
                    
                    html += `
                        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <h3 class="font-bold text-lg">${mission.title}</h3>
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusColor} bg-gray-700">
                                            ${mission.active ? 'Active' : 'Inactive'}
                                        </span>
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold text-blue-400 bg-gray-700">
                                            ${mission.type}
                                        </span>
                                    </div>
                                    <p class="text-gray-400 mb-2">${mission.description}</p>
                                    <div class="flex items-center space-x-4 text-sm">
                                        <span class="text-yellow-400">üí∞ ${mission.reward} DRX</span>
                                        <span class="text-gray-400">Category: ${mission.category}</span>
                                        <span class="text-gray-400">Priority: ${mission.priority}</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editMission('${mission.id}')" class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded text-sm transition-colors">
                                        Edit
                                    </button>
                                    <button onclick="deleteMission('${mission.id}')" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm transition-colors">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('missionsContainer').innerHTML = html;
            } catch (error) {
                console.error('Failed to load missions:', error);
            }
        }

        // Load conversions
        async function loadConversions() {
            try {
                const filter = document.getElementById('conversionFilter').value;
                const conversions = await apiRequest(`conversions&status=${filter}`);
                
                let html = '';
                conversions.forEach(conversion => {
                    const statusColor = conversion.status === 'approved' ? 'text-green-400' : 
                                       conversion.status === 'rejected' ? 'text-red-400' : 'text-yellow-400';
                    
                    html += `
                        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <h3 class="font-bold">${conversion.userName}</h3>
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusColor} bg-gray-700">
                                            ${conversion.status}
                                        </span>
                                    </div>
                                    <p class="text-gray-400 mb-2">${conversion.amount} DRX ‚Üí ${conversion.convertedAmount} ${conversion.toCurrency}</p>
                                    <div class="text-sm text-gray-400">
                                        <p>Package: ${conversion.packageType}</p>
                                        <p>Category: ${conversion.category}</p>
                                        <p>Date: ${new Date(conversion.requestedAt).toLocaleString()}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="updateConversion('${conversion.id}', 'approved')" 
                                            class="bg-green-500 hover:bg-green-600 px-3 py-1 rounded text-sm transition-colors">
                                        Approve
                                    </button>
                                    <button onclick="updateConversion('${conversion.id}', 'rejected')" 
                                            class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm transition-colors">
                                        Reject
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('conversionsContainer').innerHTML = html;
            } catch (error) {
                console.error('Failed to load conversions:', error);
            }
        }

        // Load promo codes
        async function loadPromoCodes() {
            try {
                const promoCodes = await apiRequest('promo-codes');
                
                let html = '';
                promoCodes.forEach(promo => {
                    const usedColor = promo.used_by ? 'text-red-400' : 'text-green-400';
                    
                    html += `
                        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <h3 class="font-bold font-mono text-lg">${promo.code}</h3>
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${usedColor} bg-gray-700">
                                            ${promo.used_by ? 'Used' : 'Available'}
                                        </span>
                                    </div>
                                    <p class="text-gray-400 mb-2">${promo.description}</p>
                                    <div class="text-sm text-gray-400">
                                        <p>Reward: ${promo.reward} DRX</p>
                                        <p>Created: ${new Date(promo.created_at).toLocaleString()}</p>
                                        ${promo.used_by ? `<p>Used by: ${promo.used_by_name} (${promo.used_by})</p>` : ''}
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="deletePromoCode('${promo.id}')" 
                                            class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm transition-colors">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('promoCodesContainer').innerHTML = html;
            } catch (error) {
                console.error('Failed to load promo codes:', error);
            }
        }

        // Update conversion status
        async function updateConversion(conversionId, status) {
            try {
                await apiRequest(`conversions&conversionId=${conversionId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status })
                });
                
                loadConversions(); // Reload conversions
            } catch (error) {
                console.error('Failed to update conversion:', error);
            }
        }

        // Delete promo code
        async function deletePromoCode(codeId) {
            if (confirm('Are you sure you want to delete this promo code?')) {
                try {
                    await apiRequest(`promo-codes&codeId=${codeId}`, {
                        method: 'DELETE'
                    });
                    
                    loadPromoCodes(); // Reload promo codes
                } catch (error) {
                    console.error('Failed to delete promo code:', error);
                }
            }
        }

        // Modal functions (placeholders)
        function showCreateCategoryModal() {
            console.log('Create category modal');
        }

        function showCreateMissionModal() {
            console.log('Create mission modal');
        }

        function showCreatePromoModal() {
            console.log('Create promo modal');
        }

        function editCategory(categoryId) {
            console.log('Edit category:', categoryId);
        }

        function editMission(missionId) {
            console.log('Edit mission:', missionId);
        }

        function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                console.log('Delete category:', categoryId);
            }
        }

        function deleteMission(missionId) {
            if (confirm('Are you sure you want to delete this mission?')) {
                console.log('Delete mission:', missionId);
            }
        }
    </script>
</body>
</html>